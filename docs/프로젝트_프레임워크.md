# WEAV-AI 프로젝트 프레임워크·구성

프로젝트의 기본 프레임워크와 디렉터리 구조를 정리한 문서입니다.

---

## 1. 프론트엔드

| 구분 | 기술 |
|------|------|
| **런타임/빌드** | Node.js, Vite 7 |
| **언어** | TypeScript 5.8 |
| **UI 프레임워크** | React 19 |
| **스타일** | Tailwind CSS 3, PostCSS, Autoprefixer |
| **아이콘** | lucide-react |
| **마크다운** | react-markdown, remark-gfm |
| **코드 하이라이트** | react-syntax-highlighter |
| **라우팅** | 없음 (단일 화면, React Router 미사용) |
| **상태** | React Context (ChatContext) |
| **HTTP** | fetch 기반 `apiClient` (get/post, stream) |
| **진입점** | index.html → index.tsx → App.tsx |

### 디렉터리 구조

- `src/components/chat/` — ChatView, ChatInput, ChatMessage, ModelSelector
- `src/contexts/` — ChatContext
- `src/services/api/` — aiService, apiClient
- `src/constants/` — models.ts
- `src/types.ts`, `src/index.css`

### 개발

- `npm run dev` → Vite dev (포트 3000), `/api` 프록시 → localhost:8080
- ESLint, Prettier, `tsc --noEmit`

---

## 2. 백엔드

| 구분 | 기술 |
|------|------|
| **언어** | Python 3.12 (Dockerfile 기준) |
| **프레임워크** | Django 4.2 |
| **API** | Django REST Framework 3.14 |
| **DB** | PostgreSQL (psycopg2-binary), 개발 시 SQLite |
| **설정** | python-decouple, python-dotenv |
| **CORS** | django-cors-headers |
| **AI 연동** | requests + Pydantic 2 (fal.ai HTTP API) |
| **WSGI** | Gunicorn 21 |

### 디렉터리 구조 (실무 기준)

- **config/** — Django 프로젝트 설정
  - `settings.py`, `urls.py`, `wsgi.py`, `asgi.py`, `celery.py`
- **apps/** — Django 앱
  - **users** — AUTH_USER_MODEL, admin (기본만)
  - **chats** — Session, Message, ImageRecord, Job, 세션·메시지 API
  - **core** — 헬스체크 (`/api/v1/health/`)
  - **ai** — 채팅·이미지 API (`/api/v1/chat/complete/`, `/api/v1/chat/image/`, job 상태)
- **tests/** — 프로젝트 테스트 (Docker에서만 실행)

### apps.ai 내부

- `views.py` — complete_chat, complete_image, job_status
- `tasks.py` — Celery task_chat, task_image
- `router.py` — 텍스트/이미지 라우팅
- `fal_client.py` — fal.run·OpenAI HTTP 호출
- `schemas.py` — TextGenerationRequest, ImageGenerationRequest (Pydantic)
- `errors.py` — AI 관련 예외

### 실행·테스트

- `manage.py`, `config/wsgi.py`, `config/asgi.py`
- Docker: `Dockerfile` + `entrypoint.sh` (DB 대기 → migrate → collectstatic → Gunicorn)
- **테스트**: 로컬 테스트 환경 없음. Docker에서만 실행: `make test` 또는 `docker compose run --rm api python manage.py test tests`

---

## 3. 인프라 (infra)

| 구분 | 기술 |
|------|------|
| **오케스트레이션** | Docker Compose |
| **서비스** | postgres, redis, api (Django/Gunicorn), worker (Celery), nginx (Alpine) |
| **리버스 프록시** | Nginx — 포트 8080 → api:8000, `/api/`, `/admin/`, `/healthz` |
| **네트워크** | weavai_network (bridge) |
| **볼륨** | postgres_data (DB 영속) |

### Nginx

- `infra/nginx/conf.d/weavai.conf` — API·admin·healthz 라우팅, rate limit
- `infra/nginx/conf.d/admin_allowlist.conf` — admin IP 제한

---

## 4. 프로젝트 루트

| 항목 | 용도 |
|------|------|
| **frontend/** | React + Vite 앱 (채팅 UI) |
| **backend/** | Django API (config + apps + tests) |
| **infra/** | Docker Compose (postgres, redis, api, worker, nginx) |
| **Makefile** | Docker 기준 up, down, test, migrate 등 |
| **docs/** | 참고 문서(PDF 등) |
| **.eslintrc.js, .prettierrc, .prettierignore** | 프론트 린트/포맷 |
| **.gitignore, .gitattributes** | Git 설정 |

---

## 5. 한 줄 요약

- **프론트**: React 19 + TypeScript + Vite 7 + Tailwind, 단일 화면 채팅 UI, Context + apiClient.
- **백엔드**: Django 4 + DRF + PostgreSQL/SQLite, Gunicorn, fal.ai 연동(텍스트·이미지).
- **인프라**: Docker Compose (postgres + api + nginx), Nginx 리버스 프록시.
