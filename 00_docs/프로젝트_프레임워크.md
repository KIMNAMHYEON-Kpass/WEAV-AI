# WEAV-AI 프로젝트 프레임워크·구성

프로젝트의 기본 프레임워크와 디렉터리 구조를 정리한 문서입니다.

---

## 1. 프론트엔드

| 구분 | 기술 |
|------|------|
| **런타임/빌드** | Node.js, Vite 7 |
| **언어** | TypeScript 5.8 |
| **UI 프레임워크** | React 19 |
| **스타일** | Tailwind CSS 3, PostCSS, Autoprefixer |
| **아이콘** | lucide-react |
| **마크다운** | react-markdown, remark-gfm |
| **코드 하이라이트** | react-syntax-highlighter |
| **라우팅** | 없음 (단일 화면, React Router 미사용) |
| **상태** | React Context (ChatContext) |
| **HTTP** | fetch 기반 `apiClient` (get/post, stream) |
| **진입점** | index.html → index.tsx → App.tsx |

### 디렉터리 구조

- `src/components/chat/` — ChatView, ChatInput, ChatMessage, ModelSelector
- `src/contexts/` — ChatContext
- `src/services/api/` — aiService, apiClient
- `src/constants/` — models.ts
- `src/types.ts`, `src/index.css`

### 개발

- `npm run dev` → Vite dev (포트 3000), `/api` 프록시 → localhost:8080
- ESLint, Prettier, `tsc --noEmit`

---

## 2. 백엔드

| 구분 | 기술 |
|------|------|
| **언어** | Python 3.12 (Dockerfile 기준) |
| **프레임워크** | Django 4.2 |
| **API** | Django REST Framework 3.14 |
| **DB** | PostgreSQL (psycopg2-binary). 개발·운영 모두 PostgreSQL 사용 (RAG·pgvector 대비) |
| **설정** | python-decouple, python-dotenv |
| **CORS** | django-cors-headers |
| **AI 연동** | requests + Pydantic 2 (fal.ai HTTP API) |
| **WSGI** | Gunicorn 21 |

### Django 앱

- **users** — AUTH_USER_MODEL, admin (기본만)
- **weavai.apps.core** — 헬스체크 (`/api/v1/health/`)
- **weavai.apps.ai** — 채팅·이미지 API (`/api/v1/chat/complete/`, `/api/v1/chat/image/`)

### weavai.apps.ai 내부

- `views.py` — complete_chat, complete_image
- `router.py` — 텍스트/이미지 라우팅 (OpenRouter·fal.ai)
- `fal_client.py` — fal.run HTTP 호출
- `schemas.py` — TextGenerationRequest, ImageGenerationRequest (Pydantic)
- `errors.py` — AI 관련 예외

### 실행

- `manage.py`, `weavai/wsgi.py`, `weavai/asgi.py`
- Docker: `Dockerfile` + `entrypoint.sh` (DB 대기 → migrate → collectstatic → Gunicorn)

---

## 3. 인프라 (infra)

| 구분 | 기술 |
|------|------|
| **오케스트레이션** | Docker Compose |
| **서비스** | postgres (PostgreSQL 15), redis (Redis 7), api (Django/Gunicorn), worker (Celery), nginx (Alpine) |
| **리버스 프록시** | Nginx — 포트 8080 → api:8000, `/api/`, `/admin/`, `/healthz` |
| **네트워크** | weavai_network (bridge) |
| **볼륨** | postgres_data (DB 영속) |

### Nginx

- `infra/nginx/conf.d/weavai.conf` — API·admin·healthz 라우팅, rate limit
- (선택) `infra/nginx/conf.d/admin_allowlist.conf` — admin IP 제한

---

## 4. 프로젝트 루트

| 항목 | 용도 |
|------|------|
| **frontend/** | React + Vite 앱 (채팅 UI) |
| **backend/** | Django API (채팅·이미지) |
| **infra/** | Docker Compose + Nginx |
| **00_docs/** | 프로젝트 프레임워크·참고 문서(PDF 등) |
| **.gitignore, .gitattributes** | Git 설정 (민감·로컬 제외) |
| **Makefile** | macOS/Linux Docker 래퍼 |
| **compose.ps1, compose.cmd** | Windows Docker 래퍼 |

---

## 5. 디렉터리·파일 구조 (실무 기준)

```
WEAV-AI/
├── .gitattributes          # LF/CRLF 정규화 (셸 스크립트 LF 고정)
├── .gitignore               # 민감·로컬·빌드 제외
├── Makefile                 # macOS/Linux: up, down, build, test, migrate, logs, shell
├── compose.ps1              # Windows PowerShell 래퍼
├── compose.cmd              # Windows CMD 래퍼
├── README.md
├── 00_docs/                 # 문서 (단일 위치)
│   ├── 프로젝트_프레임워크.md
│   └── (참고: llms.pdf, imagen4-preview.txt 등)
├── backend/
│   ├── .env.example
│   ├── Dockerfile
│   ├── entrypoint.sh
│   ├── manage.py
│   ├── requirements.txt
│   ├── config/              # Django 설정
│   │   ├── settings.py, urls.py, wsgi.py, asgi.py, celery.py
│   ├── apps/
│   │   ├── ai/              # 채팅·이미지 API (fal_client, router, views)
│   │   ├── chats/           # 세션·메시지·이미지 모델
│   │   ├── core/            # 헬스체크
│   │   └── users/           # 사용자 모델
│   └── tests/
├── frontend/
│   ├── .env.example
│   ├── index.html, package.json, vite.config.ts, tailwind.config.cjs
│   └── src/
│       ├── App.tsx, main.tsx, index.css, types.ts
│       ├── components/chat/, layout/
│       ├── constants/models.ts
│       ├── contexts/
│       └── services/api/
└── infra/
    ├── .env.example         # FAL_KEY 등 (실제 .env는 Git 제외)
    ├── docker-compose.yml
    └── nginx/conf.d/
```

- **Git에 올리지 않는 것**: `.env`, `backend/.env`, `frontend/.env`, `infra/.env`, `node_modules/`, `__pycache__/`, `*.db`, `backend/media/`, `backend/staticfiles/`, `*.pem`, Firebase 키 등 — `.gitignore`에 반영됨.

---

## 6. 개발 환경 (OS)

- **macOS / Linux**: Makefile (`make up`, `make build` 등) 사용.
- **Windows**: Docker Desktop 설치 후, 프로젝트 루트에서 `compose.ps1`(PowerShell) 또는 `compose.cmd`(CMD)로 동일 명령 실행. `.gitattributes`로 셸 스크립트(`*.sh`)는 LF 줄바꿈 유지해 Docker 내부 실행이 안정적.

## 7. 한 줄 요약

- **프론트**: React 19 + TypeScript + Vite 7 + Tailwind, 단일 화면 채팅 UI, Context + apiClient.
- **백엔드**: Django 4 + DRF + PostgreSQL, Gunicorn, fal.ai 연동(텍스트·이미지).
- **인프라**: Docker Compose (postgres + api + nginx), Nginx 리버스 프록시.
- **크로스 플랫폼**: Makefile(macOS/Linux) + compose.ps1/compose.cmd(Windows)로 동일 워크플로우.
